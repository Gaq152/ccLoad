<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="/web/favicon.ico">
  <title>AI Proxy Monitor</title>
  <link rel="stylesheet" href="/web/assets/css/theme.css">
  <link rel="stylesheet" href="/web/assets/css/styles.css">
  <link href="/web/assets/css/inter.css" rel="stylesheet">
  <script src="/web/assets/js/theme.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="dashboard-theme">
  <div class="app-container">
  <div class="dash-container">

    <!-- 顶部导航 -->
    <header class="dash-nav">
      <div class="dash-brand">
        <div class="status-indicator"></div>
        <span class="brand-name">AI Proxy Monitor</span>
      </div>
      <div class="dash-actions">
        <div class="refresh-timer">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <span id="refresh-countdown">30s</span>
          <button class="refresh-btn" id="refresh-btn" title="手动刷新">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 4v6h-6M1 20v-6h6"/>
              <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
            </svg>
          </button>
        </div>
        <button class="dash-btn active" data-range="today">本日</button>
        <button class="dash-btn" data-range="this_week">本周</button>
        <button class="dash-btn" data-range="this_month">本月</button>
      </div>
    </header>

    <!-- 核心指标行 -->
    <div class="dash-grid stats-row">
      <div class="dash-panel stat-panel">
        <div class="panel-header">总请求</div>
        <div class="stat-value primary" id="stat-total">--</div>
        <div class="stat-meta" id="stat-total-meta">成功 -- / 失败 --</div>
      </div>
      <div class="dash-panel stat-panel">
        <div class="panel-header">成功率</div>
        <div class="stat-value success" id="stat-rate">--%</div>
        <div class="stat-meta" id="stat-rate-meta">--</div>
      </div>
      <div class="dash-panel stat-panel">
        <div class="panel-header">Token 消耗</div>
        <div class="stat-value warning" id="stat-tokens">--</div>
        <div class="stat-meta" id="stat-tokens-meta">输入 -- / 输出 --</div>
      </div>
      <div class="dash-panel stat-panel">
        <div class="panel-header">成本</div>
        <div class="stat-value error" id="stat-cost">$--</div>
        <div class="stat-meta" id="stat-cost-meta">--</div>
      </div>
    </div>

    <!-- 图表行 -->
    <div class="dash-grid chart-row">
      <!-- 渠道健康矩阵 -->
      <div class="dash-panel health-matrix-panel">
        <div class="panel-header-row">
          <div class="panel-title">渠道健康矩阵</div>
          <div class="dash-actions matrix-controls">
            <!-- 周期切换按钮组 -->
            <button class="dash-btn active" data-period="24h">24H</button>
            <button class="dash-btn" data-period="7d">7D</button>
            <button class="dash-btn" data-period="30d">30D</button>

            <!-- 垂直分隔线 -->
            <div class="separator-vertical"></div>

            <!-- Tab 切换按钮组 -->
            <button class="dash-btn tab-btn active" data-tab="cc">CC (Claude)</button>
            <button class="dash-btn tab-btn" data-tab="cx">CX (Codex)</button>

            <!-- 垂直分隔线 -->
            <div class="separator-vertical"></div>

            <!-- 刷新倒计时和按钮 -->
            <div class="refresh-timer">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
              </svg>
              <span id="health-matrix-countdown">5:00</span>
              <button class="refresh-btn" id="health-matrix-refresh-btn" title="手动刷新">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M23 4v6h-6M1 20v-6h6"/>
                  <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                </svg>
              </button>
            </div>

            <!-- 垂直分隔线 -->
            <div class="separator-vertical"></div>

            <!-- 管理隐藏渠道按钮 -->
            <button class="dash-btn btn-icon" id="manage-hidden-btn" title="管理已隐藏渠道">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- CC (Claude) 分组 - 默认显示 -->
        <div class="service-group tab-content active" id="tab-cc">
          <div class="health-grid" id="grid-cc">
            <!-- 动态填充 -->
          </div>
        </div>

        <!-- CX (Codex) 分组 - 默认隐藏 -->
        <div class="service-group tab-content" id="tab-cx">
          <div class="health-grid" id="grid-cx">
            <!-- 动态填充 -->
          </div>
        </div>
      </div>

      <!-- 渠道状态 -->
      <div class="dash-panel">
        <div class="panel-header-row">
          <div class="panel-title">渠道状态</div>
          <div class="dash-actions">
            <button class="dash-btn active" data-channel-tab="all">全部</button>
            <button class="dash-btn" data-channel-tab="anthropic">Claude</button>
            <button class="dash-btn" data-channel-tab="codex">Codex</button>
            <button class="dash-btn" data-channel-tab="gemini">Google</button>
          </div>
        </div>
        <div class="status-list" id="channel-status-list">
          <!-- 动态填充 -->
        </div>
      </div>
    </div>

    <!-- 实时日志 -->
    <div class="dash-grid console-row">
      <div class="dash-panel console-panel">
        <div class="panel-header-row">
          <div class="panel-title">最近请求</div>
        </div>
        <div class="console-table-wrapper">
          <table class="console-table">
            <thead>
              <tr>
                <th width="70">时间</th>
                <th width="50">状态</th>
                <th>渠道</th>
                <th>模型</th>
                <th width="80">Token</th>
                <th width="70">耗时</th>
                <th width="60">成本</th>
              </tr>
            </thead>
            <tbody id="logs-tbody">
              <!-- 动态填充 -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
  </div>

  <!-- 隐藏渠道管理模态框 -->
  <div id="hidden-channels-modal" class="modal">
    <div class="modal-content" style="max-width: 520px;">
      <div class="modal-header">
        <h3 class="modal-title">已隐藏渠道管理</h3>
        <button class="close-btn" onclick="closeHiddenManager()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Tab 导航 -->
        <div class="hidden-tabs">
          <button class="hidden-tab-btn active" onclick="switchHiddenTab('cc')" id="hidden-tab-btn-cc">
            CC (Claude) <span class="hidden-badge" id="hidden-count-cc">0</span>
          </button>
          <button class="hidden-tab-btn" onclick="switchHiddenTab('cx')" id="hidden-tab-btn-cx">
            CX (Codex) <span class="hidden-badge" id="hidden-count-cx">0</span>
          </button>
        </div>

        <!-- 列表容器 -->
        <div class="hidden-list-container">
          <div id="hidden-list-cc" class="hidden-list-panel active">
            <!-- JS 动态渲染 CC 列表 -->
          </div>
          <div id="hidden-list-cx" class="hidden-list-panel">
            <!-- JS 动态渲染 CX 列表 -->
          </div>
        </div>
      </div>
      <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
        <button class="text-btn danger" onclick="restoreAllHidden()">全部恢复</button>
        <button class="dash-btn primary" onclick="closeHiddenManager()">完成</button>
      </div>
    </div>
  </div>

  <script src="/web/assets/js/ui.js"></script>
  <script src="/web/assets/js/health-matrix.js"></script>
  <script src="/web/assets/js/index.js"></script>
</body>
</html>
